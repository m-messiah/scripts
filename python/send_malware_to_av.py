#!/usr/bin/env python
# encoding: utf-8

from mechanize import Browser, DefaultFactory
from pyminizip import compress

filename = "/Users/muzafarov/Documents/viruses/21.bin"

if ".zip" not in filename:
    compress(filename, filename + ".zip", "infected", 5)
    filename = filename + ".zip"



br = Browser()

a = br.open("http://www.esetnod32.ru/support/knowledge_base/new_virus/")

br.select_form(predicate=lambda f: f.attrs.get('id', None) == 'new_license_activation_v')
print br.form

br.form.set_all_readonly(False)
br.form.add_file(open(filename), 'application/octetstream', filename[filename.rfind("/"):])

#br.form["category"] = ["2"]
br.form["email"] = "mmr@kontur.ru"
br.form["commentary"] = "Cuckoo"
#print br.form
response = br.submit()
response=response.read().decode("windows-1251")
if u"Спасибо, Ваше сообщение успешно отправлено." in response:
    print "Ok"
else:
    print response

