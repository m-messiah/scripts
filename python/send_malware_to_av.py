#!/usr/bin/env python
# encoding: utf-8

from pyminizip import compress
from requests import Session
from bs4 import BeautifulSoup

filename = "/Users/muzafarov/Documents/viruses/21.bin"

if ".zip" not in filename:
    compress(filename, filename + ".zip", "infected", 5)
    filename = filename + ".zip"

br = Session()
br.headers.update({'referer': "http://www.esetnod32.ru/support/knowledge_base/new_virus"})

hostUrl = "http://www.esetnod32.ru/support/knowledge_base/new_virus/"
page = br.get(hostUrl)
page = BeautifulSoup(page.text, 'html.parser')

form = page.find('form', id="new_license_activation_v")

form_data = dict([(el['name'], el.get('value', None))
                  for el in form.find_all('input') if el.has_attr('name')])

form_data["email"] = u"mmr@kontur.ru"
del form_data["suspicious_file"]
form_data["commentary"] = "Test"
form_data['submit'] = '\xd0\x9e\xd1\x82\xd0\xbf\xd1\x80\xd0\xb0\xd0\xb2\xd0\xb8\xd1\x82\xd1\x8c'

response = br.post(hostUrl, data=form_data,
                   files={u'suspicious_file': ("image003.zip", open(filename, 'rb'), "application/zip")})

print response.text.encode("utf8")
